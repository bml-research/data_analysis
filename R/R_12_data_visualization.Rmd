![](../hanze/hanze.png)

[Go back to the main page](../index.html)

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

# R: Data Visualization

## Data analysis methods

Here we will focus on data visualization.

>Note: We will focus on plotting using Tidyverse ggplot2. While base R has some sophisticated plotting capacities, ggplot2 is more powerful and generates more aesthetically pleasing plots (though this may be subjective of course).

## Base R plotting verses ggplot2

Base R plotting and ggplot2 are two popular plotting systems in R, but they have some key differences in terms of syntax, functionality, and philosophy.

Syntax:

Base R plotting: The base R plotting system uses a procedural approach where plots are built step-by-step using functions like plot(), lines(), points(), etc. The syntax involves specifying the data and then adding elements to the plot using different functions.
ggplot2: ggplot2 follows a declarative approach inspired by the grammar of graphics. It uses the ggplot() function to initialize a plot object and then adds layers of graphical elements using the + operator. The syntax is more concise and uses a grammar that includes mappings, aesthetics, and geometries.
Functionality:

Base R plotting: Base R offers a wide range of plotting functions with basic functionalities to create various types of plots. It provides flexibility to customize plots by directly modifying plot parameters, such as axes, labels, colors, etc. However, it requires more manual adjustments to achieve complex or customized plots.
ggplot2: ggplot2 is a highly customizable plotting system that offers a rich set of high-level plotting functions. It provides a layered approach, allowing users to easily add and modify plot elements. ggplot2 has a consistent API, making it easier to create complex plots with less code. It also includes built-in support for facets, themes, and statistical transformations.
Philosophy:

Base R plotting: The base R plotting system has been part of R since its early versions and follows a traditional approach. It focuses on providing a set of core plotting functions and allows users to have fine-grained control over plot details. It can be useful for users who prefer a more low-level and flexible plotting system.
ggplot2: ggplot2, developed by Hadley Wickham, introduces a different philosophy where the emphasis is on the grammar of graphics. It aims to provide a coherent and consistent framework for creating plots by combining independent graphical components. ggplot2 promotes the idea of "layering" to create complex plots and encourages a more structured and reproducible workflow.
Overall, ggplot2 provides a more elegant and expressive way to create publication-quality plots, particularly for exploratory data analysis and data visualization tasks. It simplifies the process of creating complex plots and offers more options for customization and extensibility compared to the base R plotting system.


## The Grammar of ggplot2

The grammar of ggplot2 is based on the Grammar of Graphics, a framework for creating visualizations. It revolves around the idea that every plot can be broken down into a set of fundamental components. Here are the main components of ggplot2:

1. Data: The first step in creating a plot with ggplot2 is to specify the dataset you want to visualize. This is typically done by passing a data frame to the ggplot() function.

2. Aesthetic mappings: Aesthetics define how variables in the dataset are mapped to visual properties of the plot, such as position, size, color, or shape. You define aesthetics using the aes() function and associate variables in your dataset with specific plot elements.

3. Geometric objects (geoms): Geoms are the visual representations of data points on a plot, such as points, lines, bars, or polygons. Geoms are added to the plot using the geom_*() functions, where * represents the type of geometric object you want to use.

4. Scales: Scales control how data values are mapped to visual properties. For example, you can use scales to adjust the range and labels of axes, apply transformations, or set color palettes. ggplot2 provides various scale functions like scale_x_continuous(), scale_color_manual(), etc.

5. Facets: Faceting allows you to create multiple small plots, each showing a subset of the data based on one or more categorical variables. Facets are added using the facet_*() functions, such as facet_grid() or facet_wrap().

6. Statistical transformations: ggplot2 provides a range of statistical transformations that summarize data before plotting. These transformations can be used to compute summaries like means, medians, or counts. Statistical transformations are applied using the stat_*() functions, such as stat_summary() or stat_smooth().

7. Coordinates: The coordinate system defines the space in which the plot is created. The default coordinate system in ggplot2 is Cartesian (x-y), but there are other coordinate systems available, such as polar coordinates. Coordinate systems are modified using the coord_*() functions.

8. Themes: Themes control the overall appearance of the plot, including the background, gridlines, fonts, and margins. ggplot2 provides several built-in themes, but you can also customize the appearance by modifying theme elements with the theme() function.

These are the core components of the ggplot2 grammar. By combining and modifying these components, you can create a wide variety of visualizations. Understanding and manipulating each component allows you to tailor your plots to effectively communicate your data.

>Note that there are some differences in naming chart types between Excel and R.
>Excel's Column charts are called bar charts in R (there are vertical and horizontal bar charts in R).
>Excel's Clustered column charts are called grouped bar charts in R.
>I will use the naming conventions in compliance of the corresponding software.

## Loading Tidyverse

Let's start with loading the tidyverse library:

```{r}
library(tidyverse)
```


## Loading a dataset

As an example dataset, we will be using the same dataset as used in the Excel section:
namely, [the nutritional facts dataset from a fastfood restaurant](https://www.kaggle.com/datasets/mcdonalds/nutrition-facts)

```{r}
file_path <- "./files_12_data_visualization/file01_menu.csv"
df <- read_csv(file_path)
head(df)
```

As you can see above, the data is loaded well. Also note that the columns are of the correct data type (e.g. dbl for the Calories column).


## Summarize each

First we create a dataset similar as the pivot table from the excel section:

```{r}
summ_data <- df %>%
  group_by(Category) %>%
  summarize_each(mean) %>%
  select(Category, Calories, `Calories from Fat`) %>%
  rename(`Calories total` = `Calories`)

summ_data
```

## Bar Chart base R

Like the example in Excel, I will first create a column chart. The example below will show you the code to make a column chart in base R:

```{r}
barplot(summ_data$`Calories from Fat`, 
        ylab = "Calories from fat", 
        ylim = c(0, max(summ_data$`Calories from Fat` + 50)), 
        names = summ_data$Category, 
        las = 2,
        cex.names = 0.5,
        col = "steelblue",
        main = "Average of calories from fat for different categories")
```

As you can see, it worked but the plot is not very aesthetically pleasing.
Also, the bar labels are to small to properly read but if they are scaled to a bigger size, they will fall of the plot area and will be truncated.
Now let's compare this with the same type of plot using the same data but now the plot will be created in ggplot2:

## Bar Chart in ggplot2


```{r}
p <- ggplot(data = summ_data, aes(x = Category, y = `Calories from Fat`)) +
  geom_bar(stat="identity", fill="steelblue") +
  labs(title="Average of calories from fat for different categories") +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
p
```

Plotting with ggplot2 is much more flexible and the plots created are very aesthetically pleasing (although this may be subjective).


## Grouped bar chart 

Now if you would like to compare this to the total amount of calories, you could create a grouped bar chart for this.
The first thing we do is to make the data tidy:

```{r}
tidy_summ_data <- summ_data %>%
  gather(`Calories total`, `Calories from Fat`, key = "Calories origin", value = "Amount of calories")
tidy_summ_data
```

As you can see, the data is in tidy format now with only a single column with the amount of calories.
Now we can easily create a grouped bar chart:

```{r}
p <- ggplot(data = tidy_summ_data, aes(x = Category, y = `Amount of calories`, fill = `Calories origin`)) +
  geom_bar(stat = "identity", position="dodge") +
  labs(title="Average of calories from fat for different categories") +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
p
```

Note that ggplot2 now splits the `Amount of calories` data based on `Calories origin`.
By using the `fill=` argument in the function call both data sets will get their own bar and bar color.
A legend is automatically generated (and highly warranted).
The `position = "dodge"` argument creates two bars next to each other.



## Stacked bar chart 

Creating a stacked bar chart is easy. Just change the `position` argument.to "stack" (or omit it altogether as it is the default parameter, but there is nothing wrong in being explicit):

```{r}
p <- ggplot(data = tidy_summ_data, aes(x = Category, y = `Amount of calories`, fill = `Calories origin`)) +
  geom_bar(stat = "identity", position="stack") +
  labs(title="Average of calories from fat for different categories") +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
p
```

## Percent stacked barchart

A percent (actually a fraction) stacked barchart can be created by changing the `position` argument to "fill";

```{r}
p <- ggplot(data = tidy_summ_data, aes(x = Category, y = `Amount of calories`, fill = `Calories origin`)) +
  geom_bar(stat = "identity", position="fill") +
  labs(title="Average of calories from fat for different categories", y = "Fraction of calories") +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
p
```

Now, the fraction of each subgroup is represented, allowing to study the change of their proportion in the whole.
Note that the y-label is modified accordingly.


## Switch order of groups

If you want to change the order of groups you will need to change the column `Calories origin` from character to a factor.

```{r}
tidy_summ_data
```



>This web page is distributed under the terms of the Creative Commons Attribution License which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.
>Creative Commons License: CC BY-SA 4.0.

